"use strict";!function(){const n={networkUrl:{main:"https://service.goldmint.io/sumus/mainnet/v1",test:"https://service.goldmint.io/sumus/testnet/v1"},api:{getBalance:"/wallet/",addTx:"/tx"},timeTxFailed:18e5};let e="\n        body, html {\n            margin: 0;\n            padding: 0;\n            max-width: 300px;\n            width: 100%;\n            height: 520px;\n            overflow: hidden;\n            font-size: 16px;\n            font-family: Avenir,Helvetica,Arial,sans-serif;\n            line-height: 1.5;\n        }\n        header {\n            background: #212121;\n            color: #ccc;\n            height: 57px;\n            padding: 0 1rem;\n            display: flex;\n            align-items: center;\n        }\n        .icon-gold {\n            color: #e9cb6b;\n            fill: #e9cb6b;\n        }\n        .confirm-container, .failed-container {\n            padding: 1rem;\n        }\n        .confirm-block {\n            margin-top: 0.5rem;\n        }\n        .h4, h4 {\n            font-size: 1.5rem;\n            margin-top: 0;\n            margin-bottom: 1rem;\n            font-weight: 500;\n            line-height: 1.2;\n        }\n        .confirm-info-block {\n            border-bottom: 2px solid #e9cb6b;\n            border-top: 2px solid #e9cb6b;\n            padding: 0.5rem 0;\n        }\n        .button-block {\n            display: flex;\n            margin-top: 1.5rem;\n        }\n        .confirm-address-block {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n        }\n        .confirm-item {\n            font-size: 14px;\n            color: #7a7a7a;\n        }\n        .confirm-item.name {\n            max-width: 86px;\n            min-width: 86px;\n            overflow: hidden;\n        }\n        .confirm-details-block {\n            text-align: center;\n            margin-top: 0.5rem;\n        }\n        .trs-fee {\n            font-size: .875rem;\n        }\n        .nonce-info {\n            font-size: .75em;\n            color: #ababab;\n        }\n        .btn:not(:disabled):not(.disabled) {\n            cursor: pointer;\n        }\n        .btn {\n            font-size: 1.125rem;\n            letter-spacing: .1em;\n            text-transform: uppercase;\n            padding: .875rem 1.25rem;\n            min-height: 57px;\n            min-width: 150px;\n            cursor: pointer;\n            display: inline-block;\n            font-weight: 700;\n            text-align: center;\n            white-space: nowrap;\n            vertical-align: middle;\n            -webkit-user-select: none;\n            -moz-user-select: none;\n            -ms-user-select: none;\n            user-select: none;\n            border: 1px solid transparent;\n            line-height: 1.5;\n            border-radius: 0;\n            transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\n        }\n        .btn-sm {\n            font-size: .875rem;\n            line-height: 1rem;\n            letter-spacing: 0;\n            text-transform: none;\n            padding: .625rem .875rem;\n            min-height: 38px;\n            min-width: 75px;\n        }\n        .btn-primary {\n            background-color: #e9cb6b;\n            border-color: #e9cb6b;\n            color: #1c1c1c;\n        }\n        .btn-cancel {\n            margin-right: 0.25rem;\n            width: 50%;\n        }\n        .btn-confirm {\n            margin-left: 0.25rem;\n            width: 50%;\n        }\n        [type=reset], [type=submit], button, html [type=button] {\n            -webkit-appearance: button;\n        }\n        .btn-primary:hover {\n            color: #212529;\n            background-color: #fadc7d;\n            border-color: #fadc7d;\n        }\n        .btn:focus, .btn:hover {\n            text-decoration: none;\n            outline: none;\n        }\n        .btn-primary:not(:disabled):not(.disabled).active, .btn-primary:not(:disabled):not(.disabled):active, .show>.btn-primary.dropdown-toggle {\n            background-color: #fadc7d;\n            border-color: #fadc7d;\n        }\n        .btn-primary:not([disabled]):not(.disabled).active, .btn-primary:not([disabled]):not(.disabled):active {\n            color: #fff;\n        }\n        .btn-primary.focus, .btn-primary:focus, .btn-primary:not(:disabled):not(.disabled).active:focus, .btn-primary:not(:disabled):not(.disabled):active:focus, .show>.btn-primary.dropdown-toggle:focus {\n            box-shadow: 0 0 0 0.2rem rgba(233,203,107,.5);\n        }\n        .failed-icon {\n            text-align: center;\n        }\n        .btn-done {\n            width: 100%;\n        }\n        .btn-primary.disabled, .btn-primary:disabled {\n            color: #212529;\n            background-color: #e9cb6b;\n            border-color: #e9cb6b;\n            cursor: not-allowed;\n        }\n        .btn.disabled, .btn:disabled {\n            opacity: .65;\n        }\n        .failed-container {\n            display: none;\n        }\n        body.failed .confirm-container {\n            display: none;\n        }\n        body.failed .failed-container {\n            display: block;\n        }\n    ",t={};window.location.search.replace(/^\?/,"").split("&").forEach(n=>{let e=n.split("=");t[decodeURIComponent(e[0])]=e.length>1?decodeURIComponent(e[1]):""});let o,i,r,a,s,d,l,c="undefined"!=typeof InstallTrigger,m=c?browser:chrome,b=window.SumusLib,f=CryptoJS,p=t.id,u=t.tabId,g={};function h(n){n.identifier&&(l=n.identifier)}function x(e,t,i){w("POST",n.networkUrl[d]+n.api.addTx,{data:e,name:t}).then(e=>{e?function(e){m.storage.local.get(null,t=>{r=t.unconfirmedTx,s=t.wallets;let i=(new Date).getTime()+n.timeTxFailed;s=s.map(n=>(n.publicKey===a.from&&(n.tx={hash:e,endTime:i,amount:a.amount,token:a.token.toUpperCase(),network:d},n.nonce=o+1),n)),r.forEach((n,e)=>{n.id==p&&r.splice(e,1)}),m.storage.local.set({wallets:s},()=>{m.storage.local.set({unconfirmedTx:r},()=>{m.runtime.sendMessage({sendTxResult:{hash:e,id:p,tabId:u}}),v()})})})}(i):y()})}function w(n,e,t=""){let o=new XMLHttpRequest,i="GET"===n.toUpperCase()?e+t:e;return o.open(n.toUpperCase(),i,!0),o.setRequestHeader("Content-Type","application/json"),"GET"===n.toUpperCase()?o.send():o.send(JSON.stringify(t)),new Promise((n,e)=>{o.onload=(()=>{if(o.status>=200&&o.status<300)try{n(JSON.parse(o.responseText))}catch(e){n(null)}else n(null)})})}function y(){document.body.classList.add("failed"),m.runtime.sendMessage({sendTxResult:{hash:null,id:p,tabId:u}},()=>{k(!1)})}function T(){E();const n=function(n,e,t,o,i){let r=b.Transaction.TransferAsset(n,i,e,t,o.toPrecision(18));return{txData:r.Data(),txDigest:r.Digest(),txName:r.Name()}}(i,a.to,a.token.toUpperCase(),a.amount,o+1);x(n.txData,n.txName,n.txDigest)}function k(n=!0){m.storage.local.get(null,e=>{(r=e.unconfirmedTx).forEach((n,e)=>{n.id==p&&r.splice(e,1)}),m.storage.local.set({unconfirmedTx:r},()=>{m.runtime.sendMessage({sendTxResult:{hash:null,id:p,tabId:u}}),n&&v()})})}function v(){m.windows.getCurrent(n=>{m.windows.remove(n.id)})}function C(n){return n.slice(0,6)+"...."+n.slice(-4)}function E(){g.btnConfirm.setAttribute("disabled","disabled"),g.btnClose.setAttribute("disabled","disabled")}!function(){(function(){let n=document.createElement("style");n.type="text/css",n.appendChild(document.createTextNode(e)),document.head.appendChild(n)})(),c?m.runtime.onMessage.addListener((n,e,t)=>{h(n)}):m.extension.onMessage.addListener((n,e,t)=>{h(n)});m.runtime.sendMessage({getIdentifier:!0}),t=["infoFrom","infoTo","infoAmount","infoFee","infoNonce","btnClose","btnConfirm","btnDone"],t.forEach(n=>{g[n]=document.getElementById(n)}),g.btnClose.addEventListener("click",k),g.btnConfirm.addEventListener("click",T),g.btnDone.addEventListener("click",v),E(),m.storage.local.get(null,e=>{s=e.wallets,(r=e.unconfirmedTx).forEach(e=>{e.id==p&&(e.tabId=u,d=e.network,m.storage.local.set({unconfirmedTx:r},()=>{}),w("GET",n.networkUrl[d]+n.api.getBalance,e.from).then(n=>{if(n){o=+n.res.approved_nonce;try{let n;for(let t=0;t<s.length;t++)if(s[t].publicKey===e.from){n=s[t].privateKey,s[t].nonce<o?(s[t].nonce=o,m.storage.local.set({wallets:s},()=>{})):o=s[t].nonce;break}a=e,i=f.AES.decrypt(n,l).toString(f.enc.Utf8),g.infoFrom.innerHTML=C(e.from),g.infoTo.innerHTML=C(e.to),g.infoAmount.innerHTML=e.amount+" "+e.token.toUpperCase(),g.infoFee.innerHTML=function(n,e){let t;"MNT"===e.toUpperCase()&&(t=.02);if(n<10)t=1*n/100;else if(n>=10&&n<1e3)t=.3*n/100;else if(n>=1e3&&n<1e4)t=.03*n/100;else if(n>=1e4){const e=.03*n/100;t=e>=.002?.002:e<=2e-4?2e-4:e}return function(n){const e=function(n){let e=String(n).split(/[eE]/);if(1==e.length)return e[0];let t="",o=n<0?"-":"",i=e[0].replace(".",""),r=Number(e[1])+1;if(r<0){for(t=o+"0.";r++;)t+="0";return t+i.replace(/^\-/,"")}r-=i.length;for(;r--;)t+="0";return i+t}(n),t=e.toString().indexOf(".");return t>=0?e.toString().substr(0,t+9).replace(/0+$/,""):e}(t)}(e.amount,e.token)+" "+e.token.toUpperCase(),g.infoNonce.innerHTML=o+1,g.btnConfirm.removeAttribute("disabled"),g.btnClose.removeAttribute("disabled")}catch(n){y()}}else y()}))})});var t}()}();