"use strict";!function(){const n={networkUrl:{main:"https://service.goldmint.io/mint/mainnet/v1",test:"https://service.goldmint.io/mint/testnet/v1"},api:{getBalance:"/wallet/",addTx:"/tx",blockChainStatus:"/status"},timeTxFailed:18e5};let e="\n        body, html {\n            margin: 0;\n            padding: 0;\n            max-width: 300px;\n            width: 100%;\n            height: 520px;\n            overflow: hidden;\n            font-size: 16px;\n            font-family: Avenir,Helvetica,Arial,sans-serif;\n            line-height: 1.5;\n        }\n        header {\n            background: #212121;\n            color: #ccc;\n            height: 57px;\n            padding: 0 1rem;\n            display: flex;\n            align-items: center;\n        }\n        .icon-gold {\n            color: #e9cb6b;\n            fill: #e9cb6b;\n        }\n        .confirm-container, .failed-container {\n            padding: 1rem;\n        }\n        .confirm-block {\n            margin-top: 0.5rem;\n        }\n        .h4, h4 {\n            font-size: 1.5rem;\n            margin-top: 0;\n            margin-bottom: 1rem;\n            font-weight: 500;\n            line-height: 1.2;\n        }\n        .confirm-info-block {\n            border-bottom: 2px solid #e9cb6b;\n            border-top: 2px solid #e9cb6b;\n            padding: 0.5rem 0;\n        }\n        .button-block {\n            display: flex;\n            margin-top: 1.5rem;\n        }\n        .confirm-address-block {\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n        }\n        .confirm-item {\n            font-size: 14px;\n            color: #7a7a7a;\n        }\n        .confirm-item.name {\n            max-width: 104px;\n            min-width: 86px;\n            overflow: hidden;\n        }\n        .confirm-details-block {\n            text-align: center;\n            margin-top: 0.5rem;\n        }\n        .trs-fee {\n            font-size: .875rem;\n        }\n        .nonce-info {\n            font-size: .75em;\n            color: #ababab;\n        }\n        .btn:not(:disabled):not(.disabled) {\n            cursor: pointer;\n        }\n        .btn {\n            font-size: 1.125rem;\n            letter-spacing: .1em;\n            text-transform: uppercase;\n            padding: .875rem 1.25rem;\n            min-height: 57px;\n            min-width: 150px;\n            cursor: pointer;\n            display: inline-block;\n            font-weight: 700;\n            text-align: center;\n            white-space: nowrap;\n            vertical-align: middle;\n            -webkit-user-select: none;\n            -moz-user-select: none;\n            -ms-user-select: none;\n            user-select: none;\n            border: 1px solid transparent;\n            line-height: 1.5;\n            border-radius: 0;\n            transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;\n        }\n        .btn-sm {\n            font-size: .875rem;\n            line-height: 1rem;\n            letter-spacing: 0;\n            text-transform: none;\n            padding: .625rem .875rem;\n            min-height: 38px;\n            min-width: 75px;\n        }\n        .btn-primary {\n            background-color: #e9cb6b;\n            border-color: #e9cb6b;\n            color: #1c1c1c;\n        }\n        .btn-cancel {\n            margin-right: 0.25rem;\n            width: 50%;\n        }\n        .btn-confirm {\n            margin-left: 0.25rem;\n            width: 50%;\n        }\n        [type=reset], [type=submit], button, html [type=button] {\n            -webkit-appearance: button;\n        }\n        .btn-primary:hover {\n            color: #212529;\n            background-color: #fadc7d;\n            border-color: #fadc7d;\n        }\n        .btn:focus, .btn:hover {\n            text-decoration: none;\n            outline: none;\n        }\n        .btn-primary:not(:disabled):not(.disabled).active, .btn-primary:not(:disabled):not(.disabled):active, .show>.btn-primary.dropdown-toggle {\n            background-color: #fadc7d;\n            border-color: #fadc7d;\n        }\n        .btn-primary:not([disabled]):not(.disabled).active, .btn-primary:not([disabled]):not(.disabled):active {\n            color: #fff;\n        }\n        .btn-primary.focus, .btn-primary:focus, .btn-primary:not(:disabled):not(.disabled).active:focus, .btn-primary:not(:disabled):not(.disabled):active:focus, .show>.btn-primary.dropdown-toggle:focus {\n            box-shadow: 0 0 0 0.2rem rgba(233,203,107,.5);\n        }\n        .failed-icon {\n            text-align: center;\n            margin-top: 24px;\n        }\n        .failed-text {\n            margin-bottom: 8px;\n        }\n        .btn-done {\n            width: 100%;\n        }\n        .btn-primary.disabled, .btn-primary:disabled {\n            color: #212529;\n            background-color: #e9cb6b;\n            border-color: #e9cb6b;\n            cursor: not-allowed;\n        }\n        .btn.disabled, .btn:disabled {\n            opacity: .65;\n        }\n        .failed-container {\n            display: none;\n        }\n        body.failed .confirm-container {\n            display: none;\n        }\n        body.failed .failed-container {\n            display: block;\n        }\n    ",t={};window.location.search.replace(/^\?/,"").split("&").forEach(n=>{let e=n.split("=");t[decodeURIComponent(e[0])]=e.length>1?decodeURIComponent(e[1]):""});let o,r,i,a,s,l,c,d="undefined"!=typeof InstallTrigger,b=d?browser:chrome,m=CryptoJS,f=t.id,p=t.tabId,u={},g=0;function h(n){n.identifier&&(c=n.identifier)}function x(e,t,r){w("GET",n.networkUrl[l]+n.api.blockChainStatus).then(c=>{c&&c.res&&c.res.blockchain_state&&c.res.blockchain_state.block_count?w("POST",n.networkUrl[l]+n.api.addTx,{name:t,data:e}).then(d=>{d?function(e,t,r,c){b.storage.local.get(null,d=>{i=d.unconfirmedTx,s=d.wallets;let m=(new Date).getTime()+n.timeTxFailed;s=s.map(n=>{if(n.publicKey===a.from){let i={hash:e,endTime:m,amount:a.amount,token:a.token.toUpperCase(),network:l,nonce:o,blockId:c?+c-1:null,data:{data:t,name:r}};n.tx?n.tx.push(i):n.tx=[i]}return n}),i.forEach((n,e)=>{n.id==f&&i.splice(e,1)}),b.storage.local.set({wallets:s},()=>{b.storage.local.set({unconfirmedTx:i},()=>{b.runtime.sendMessage({sendTxResult:{hash:e,id:f,tabId:p}}),T()})})})}(r,e,t,c.res.blockchain_state.block_count):y()}).catch(n=>{let e=!1;n.res&&(n.res.code?42==n.res.code||43==n.res.code?u.errorMessage.textContent="Transaction pool overflow":n.res.code&&n.res.wallet_inconsistency?u.errorMessage.textContent="Not enough funds":n.res.code&&n.res.nonce_ahead?u.errorMessage.textContent="Transaction is out of range":n.res.code&&res.nonce_behind&&(o++,setTimeout(()=>{g>=10?y():(g++,k())},200),e=!0):u.errorMessage.textContent="Service is unavailable. Please retry later"),!e&&y()}):y()}).catch(()=>{y()})}function w(n,e,t=""){let o=new XMLHttpRequest,r="GET"===n.toUpperCase()?e+t:e;return o.open(n.toUpperCase(),r,!0),o.setRequestHeader("Content-Type","application/json"),"GET"===n.toUpperCase()?o.send():o.send(JSON.stringify(t)),new Promise((n,e)=>{o.onload=(()=>{if(o.status>=200&&o.status<300)try{n(JSON.parse(o.responseText))}catch(e){n(null)}else try{e(JSON.parse(o.responseText))}catch(e){n(null)}})})}function y(){document.body.classList.add("failed"),C(!1)}function k(){S();const n=function(n,e,t,o,r){const i=window.mint.Signer.FromPK(n);let a;try{o=+o,a=i.SignTransferAssetTx(r,e,t,o.toPrecision(18))}catch(n){return y()}return{txData:a.Data,txDigest:a.Digest,txName:a.Name}}(r,a.to,a.token.toUpperCase(),a.amount,o);x(n.txData,n.txName,n.txDigest)}function C(n=!0){b.storage.local.get(null,e=>{(i=e.unconfirmedTx).forEach((n,e)=>{n.id==f&&i.splice(e,1)}),b.storage.local.set({unconfirmedTx:i},()=>{b.runtime.sendMessage({sendTxResult:{hash:null,id:f,tabId:p}}),n&&T()})})}function T(){b.windows.getCurrent(n=>{b.windows.remove(n.id)})}function v(n){return n.slice(0,6)+"...."+n.slice(-4)}function E(n){const e=function(n){let e=String(n).split(/[eE]/);if(1==e.length)return e[0];let t="",o=n<0?"-":"",r=e[0].replace(".",""),i=Number(e[1])+1;if(i<0){for(t=o+"0.";i++;)t+="0";return t+r.replace(/^\-/,"")}i-=r.length;for(;i--;)t+="0";return r+t}(n),t=e.toString().indexOf(".");return t>=0?e.toString().substr(0,t+9).replace(/0+$/,""):e}function S(){u.btnConfirm.setAttribute("disabled","disabled"),u.btnClose.setAttribute("disabled","disabled")}!function(){(function(){let n=document.createElement("style");n.type="text/css",n.appendChild(document.createTextNode(e)),document.head.appendChild(n)})(),d?b.runtime.onMessage.addListener((n,e,t)=>{h(n)}):b.extension.onMessage.addListener((n,e,t)=>{h(n)});b.runtime.sendMessage({getIdentifier:!0}),t=["infoFrom","infoTo","infoAmount","infoFee","infoNonce","btnClose","btnConfirm","btnDone","errorMessage"],t.forEach(n=>{u[n]=document.getElementById(n)}),u.btnClose.addEventListener("click",C),u.btnConfirm.addEventListener("click",k),u.btnDone.addEventListener("click",T),S(),b.storage.local.get(null,e=>{s=e.wallets,(i=e.unconfirmedTx).forEach(e=>{e.id==f&&(e.tabId=p,l=e.network,b.storage.local.set({unconfirmedTx:i},()=>{}),w("GET",n.networkUrl[l]+n.api.getBalance,e.from).then(n=>{if(n){o=+n.res.approved_nonce+1;try{let n;for(let t=0;t<s.length;t++)if(s[t].publicKey===e.from){n=s[t].privateKey;break}a=e,r=m.AES.decrypt(n,c).toString(m.enc.Utf8),u.infoFrom.textContent=v(e.from),u.infoTo.textContent=v(e.to),u.infoAmount.textContent=e.amount+" "+e.token.toUpperCase(),u.infoFee.textContent=function(n,e){let t;if("MNT"===e.toUpperCase())return E(t=.02);if(n<10)t=1*n/100;else if(n>=10&&n<1e3)t=.3*n/100;else if(n>=1e3&&n<1e4)t=.03*n/100;else if(n>=1e4){const e=.03*n/100;t=e>=.002?.002:e<=2e-4?2e-4:e}return E(t)}(e.amount,e.token)+" "+e.token.toUpperCase(),u.infoNonce.textContent=o,u.btnConfirm.removeAttribute("disabled"),u.btnClose.removeAttribute("disabled")}catch(n){y()}}else y()}))})});var t}()}();
